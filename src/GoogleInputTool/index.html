<html>

<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>GIT</title>
</head>

<style>
#input_tool_wrapper {
    width: 100%;
    border: 1px solid #333;
}
#input_tool {
    width: 100%;
}
#input_tool_helper {
   border: 1px solid #ccc;
   height: 100px;
   width: 100%;
}
</style>

<body>


<div id="input_tool_wrapper">
	<textarea id="input_tool" rows="20"></textarea>
	<div id="input_tool_helper"></div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script>

console.log('here');
$(document).ready(function() {
    $('#input_tool').on('keyup', function (e) {
	if (e.which == 32) {
	    let words = $(this).val().split(' ');

	    //Need to take care of space, plus index 0 - so need to deduct 2 to get last word
            let lastWord = words[words.length - 2];
            console.log('last word', lastWord);

	    googleTranslate(lastWord, sourceLanguage, targetLanguage)
            .then(function(response) {
	        console.log('Transliterated Text', response);
                console.log('first suggestion', response[0]);

		let buttons = '';
		response.forEach(function(input) {
		    buttons += '<button class="btn">' + input + '</button>';
			
		    console.log('input value', input);
		});

     		console.log(buttons);

                //Need Validation
		$('#input_tool_helper').empty(); //Clear the content of div
                $('#input_tool_helper').append(buttons);

		$('.btn').on('click', function(e) {
		    console.log('button clicked');
		    let buttonClickedValue = $(this).html();
                    console.log('Button Clicked Value', buttonClickedValue);
		    

		    let words = $('#input_tool').val().split(' ');
		    words[words.length - 2] = buttonClickedValue;
		    words = words.join(" ");
	    	    $('#input_tool').val(words);
		});

		words[words.length - 2] = response[0];
                words = words.join(" ");

		$('#input_tool').val(words);
	    });

	}
    });
});

let googleTranslate = function(sourceText, sourceLanguage, targetLanguage) {
    return new Promise(function(resolve, reject) {            
        let encodedUrl = encodeURI('https://inputtools.google.com/request?text=' + sourceText + '&itc=ne-t-i0-und&num=13&cp=0&cs=1&ie=utf-8&oe=utf-8&app=demopage');

        // Do the usual XHR stuff
        let request = new XMLHttpRequest();
        request.open('GET', encodedUrl);        

        request.onreadystatechange = function() {
            // This is called even on 404 etc
            // so check the status
            if (request.status == 200) {
                let json = JSON.parse(request.response);                

                // Resolve the promise with the response text
                resolve(json[1][0][1]);
            } else {
                // Otherwise reject with the status text
                // which will hopefully be a meaningful error
                reject('Rejected !' + request.status);
            }
        };

        // Handle network errors
        request.onerror = function() {
          reject(Error("Network Error"));
        };

        // Make the request
        request.send();
    });
}

let sourceText = 'sambhu';
let sourceLanguage = 'en';
let targetLanguage = 'ne';

googleTranslate(sourceText, sourceLanguage, targetLanguage)
.then(function(response) {
    console.log('Transliterated Text', response);
});

</script>

</body>
</html>
